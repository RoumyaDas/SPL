<!DOCTYPE html>
<html lang="en">
<head>
  <title>Roumya's Cricket Stats</title>
  <link rel="stylesheet" href="style.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roumya's IPL Stats</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Include this in case you want to inline critical CSS */
    .tab-content { display: none; padding: 20px; }
    .tab-content.active { display: block; }

    .career-subtab {
      padding: 8px 16px;
      margin-right: 5px;
      border: 1px solid #888;
      background-color: #cce0ff;
      cursor: pointer;
      font-weight: bold;
    }

    .career-subtab.active {
      background-color: #ffffff;
      border-bottom: none;
    }

    .career-table {
      display: none;
    }

    .career-table.active {
      display: block;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    input[type="text"] {
      margin-top: 10px;
      padding: 5px;
      width: 250px;
    }

    .tabs button {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <h1>Welcome to Roumya's IPL Stats</h1>
  <p>All player stats are precomputed. No live updates.</p>

  <div class="tabs">
    <button class="main-tab active" data-tab="seasons">Seasons</button>
    <button class="main-tab" data-tab="career">Career</button>
  </div>

  <div id="seasons" class="tab-content active">
    <h2>Season Stats</h2>
    <p>Coming soon...</p>
  </div>

  <div id="career" class="tab-content" style="background-color: #e0f0ff;">
    <h2>Career Stats</h2>

    <div class="tabs">
      <button class="career-subtab active" data-tab="batting">Batting</button>
      <button class="career-subtab" data-tab="bowling">Bowling</button>
      <button class="career-subtab" data-tab="fielding">Fielding</button>
    </div>

    <label for="careerSearch">Search Player:</label>
    <input type="text" id="careerSearch" placeholder="Type player name..." />

    <div id="batting" class="career-table active">
      <table>
        <thead id="battingHead"></thead>
        <tbody id="battingBody"></tbody>
      </table>
    </div>

    <div id="bowling" class="career-table">
      <table>
        <thead id="bowlingHead"></thead>
        <tbody id="bowlingBody"></tbody>
      </table>
    </div>

    <div id="fielding" class="career-table">
      <table>
        <thead id="fieldingHead"></thead>
        <tbody id="fieldingBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // Tab navigation for main tabs
    document.querySelectorAll(".main-tab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".main-tab").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    // CSV File URLs
    const csvUrls = {
      batting: "https://raw.githubusercontent.com/RoumyaDas/SPL/main/SPL/data/Season_03/career/batting.csv",
      bowling: "https://raw.githubusercontent.com/RoumyaDas/SPL/main/SPL/data/Season_03/career/bowling.csv",
      fielding: "https://raw.githubusercontent.com/RoumyaDas/SPL/main/SPL/data/Season_03/career/fielding.csv"
    };

    const csvData = {};

    function parseCSV(csvText) {
      const lines = csvText.trim().split("\n");
      const headers = lines[0].split(",");
      const rows = lines.slice(1).map(line => {
        const values = line.split(",");
        return Object.fromEntries(headers.map((h, i) => [h, values[i]]));
      });
      return { headers, rows };
    }

    function renderCareerSection(type, data, searchTerm = "", sortConfig = {}) {
        const head = document.getElementById(`${type}Head`);
        const body = document.getElementById(`${type}Body`);
        head.innerHTML = "";
        body.innerHTML = "";

        const tr = document.createElement("tr");
        data.headers.forEach((h, idx) => {
            const th = document.createElement("th");
            th.textContent = h;
            th.style.cursor = "pointer";

            // Add sort indicator
            if (sortConfig.column === idx) {
            th.textContent += sortConfig.order === "asc" ? " ▲" : " ▼";
            }

            // Sort on click
            th.addEventListener("click", () => {
            const currentOrder = (sortConfig.column === idx && sortConfig.order === "asc") ? "desc" : "asc";
            const sortedRows = [...data.rows].sort((a, b) => {
                const aVal = a[h];
                const bVal = b[h];
                const isNumeric = !isNaN(parseFloat(aVal)) && !isNaN(parseFloat(bVal));

                if (isNumeric) {
                return currentOrder === "asc" ? aVal - bVal : bVal - aVal;
                } else {
                return currentOrder === "asc"
                    ? aVal.localeCompare(bVal)
                    : bVal.localeCompare(aVal);
                }
            });

            renderCareerSection(type, { headers: data.headers, rows: sortedRows }, document.getElementById("careerSearch").value, {
                column: idx,
                order: currentOrder
            });
            });

            tr.appendChild(th);
        });
        head.appendChild(tr);

        let filtered = data.rows;
        if (searchTerm) {
            filtered = filtered.filter(row =>
            row[data.headers[0]].toLowerCase().includes(searchTerm.toLowerCase())
            );
        }

        filtered.slice(0, 20).forEach(row => {
            const tr = document.createElement("tr");
            data.headers.forEach(h => {
            const td = document.createElement("td");
            td.textContent = row[h];
            tr.appendChild(td);
            });
            body.appendChild(tr);
        });
        }


    for (let type in csvUrls) {
      fetch(csvUrls[type])
        .then(res => res.text())
        .then(text => {
          const parsed = parseCSV(text);
          csvData[type] = parsed;
          if (type === "batting") {
            renderCareerSection("batting", parsed);
          }
        });
    }

    document.querySelectorAll(".career-subtab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".career-subtab").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".career-table").forEach(t => t.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
        renderCareerSection(btn.dataset.tab, csvData[btn.dataset.tab], document.getElementById("careerSearch").value);
      });
    });

    document.getElementById("careerSearch").addEventListener("input", () => {
      const tab = document.querySelector(".career-subtab.active").dataset.tab;
      renderCareerSection(tab, csvData[tab], document.getElementById("careerSearch").value);
    });
  </script>
</body>
</html>
