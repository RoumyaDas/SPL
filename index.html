<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SPL Stats</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
  <style>
    /* Critical CSS (minimal) */
    .tab-content { display: none; padding: 20px; }
    .tab-content.active { display: block; }
    .season-content { display: none; }
    .season-content.active { display: block; }
    .season-subtab-content { display: none; }
    .season-subtab-content.active { display: block; }
    .career-table { display: none; }
    .career-table.active { display: block; }
  </style>
</head>
<body>
  <h1>Welcome to SPL :: where champions are curated.</h1>
  <p>All player stats are precomputed. No live updates.</p>


  
    <!-- Main Tabs -->
    <div class="tabs">
      <button class="main-tab" data-tab="about">About</button> <!-- now consistent -->
      <button class="main-tab" data-tab="seasons">Seasons</button>
      <button class="main-tab" data-tab="schedule">Schedule</button> <!-- Schedule tab -->
      <button class="main-tab" data-tab="career">Career</button>
      <button class="main-tab" data-tab="special">Special Stats</button>
      <button class="main-tab" data-tab="stats">Stats</button>
    </div>
    

  </div>

  <div id="about" class="tab-content">
    <pre id="readme-content">Loading README...</pre>
  </div>
  
  <!-- In index.html, replace the Stats tab with this: -->
<div id="stats" class="tab-content">
  <h2>Stats</h2>

  <!-- Search Filter -->
  <label for="statsSearch">Search:</label>
  <input type="text" id="statsSearch" placeholder="Type to filter..." />

  <!-- Season Subtabs -->
  <div class="tabs" id="stats-season-tabs">
    <!--<button class="stats-season-tab active" data-season="S01">Season 01</button>-->
    <!--<button class="stats-season-tab" data-season="S02">Season 02</button>-->
    <!--<button class="stats-season-tab" data-season="S03">Season 03</button>-->
  </div>

  <!-- Stats Subtabs -->
  <div class="tabs" id="stats-subtabs">
    <!-- JS will auto-populate 23 buttons here -->
  </div>

  <!-- Stats Table Output -->
  <div id="stats-table-container" class="csv-table-output" style="margin-top: 10px;"></div>
</div>


  <!-- Seasons Tab Content -->
  <div id="seasons" class="tab-content active">
    <h2>Season Stats</h2>
  
    <div class="tabs" id="season-tabs">
      <button class="season-tab active" data-season="01">01</button>
      <button class="season-tab" data-season="02">02</button>
      <button class="season-tab" data-season="03">03</button>
    </div>
  
    <!-- Season 01 -->
    <div id="season-01" class="season-content active">
      <div class="tabs" id="season-01-subtabs">
        <button class="season-subtab active" data-subtab="flow-01">Flow</button>
        <button class="season-subtab" data-subtab="scorecard-01">Scorecard</button>
        <button class="season-subtab" data-subtab="graphs-01">Graphs</button>
      </div>
  
      <div id="flow-01" class="season-subtab-content active">
        <pre id="flow-content-01"></pre>
      </div>
      <div id="scorecard-01" class="season-subtab-content">
        <div id="scorecard-table-01"></div>
      </div>

  <div id="csv-table-container"></div>
</div>


      <div id="graphs-01" class="season-subtab-content">
        <p>Graphs coming soon...</p>
      </div>
    </div>
  
    <!-- Season 02 -->
    <div id="season-02" class="season-content">
      <div class="tabs" id="season-02-subtabs">
        <button class="season-subtab active" data-subtab="flow-02">Flow</button>
        <button class="season-subtab" data-subtab="scorecard-02">Scorecard</button>
        <button class="season-subtab" data-subtab="graphs-02">Graphs</button>
      </div>
  
      <div id="flow-02" class="season-subtab-content active">
        <pre id="flow-content-02"></pre>
      </div>
      <div id="scorecard-02" class="season-subtab-content">
        <div id="scorecard-table-02"></div>
      </div>
      <div id="graphs-02" class="season-subtab-content">
        <p>Graphs coming soon...</p>
      </div>
    </div>
  
    <!-- Season 03 -->
    <div id="season-03" class="season-content">
      <div class="tabs" id="season-03-subtabs">
        <button class="season-subtab active" data-subtab="flow-03">Flow</button>
        <button class="season-subtab" data-subtab="scorecard-03">Scorecard</button>
        <button class="season-subtab" data-subtab="graphs-03">Graphs</button>
      </div>
  
      <div id="flow-03" class="season-subtab-content active">
        <pre id="flow-content-03"></pre>
      </div>
      <div id="scorecard-03" class="season-subtab-content">
        <div id="scorecard-table-03"></div>
      </div>
      <div id="graphs-03" class="season-subtab-content">
        <p>Graphs coming soon...</p>
      </div>
    </div>
  </div>

  <!-- Career Tab Content -->
  <div id="career" class="tab-content">
    <h2>Career Stats</h2>

    <div class="tabs">
      <button class="career-subtab active" data-tab="batting">Batting</button>
      <button class="career-subtab" data-tab="bowling">Bowling</button>
      <button class="career-subtab" data-tab="fielding">Fielding</button>
    </div>

    <label for="careerSearch">Search Player:</label>
    <input type="text" id="careerSearch" placeholder="Type player name..." />

    <div id="batting" class="career-table active">
      <table>
        <thead id="battingHead"></thead>
        <tbody id="battingBody"></tbody>
      </table>
    </div>

    <div id="bowling" class="career-table">
      <table>
        <thead id="bowlingHead"></thead>
        <tbody id="bowlingBody"></tbody>
      </table>
    </div>

    <div id="fielding" class="career-table">
      <table>
        <thead id="fieldingHead"></thead>
        <tbody id="fieldingBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Special Stats Tab Content -->
<div id="special" class="tab-content">
  <h2>Special Stats</h2>

  <!-- Search Filter -->
  <label for="specialSearch">Search:</label>
  <input type="text" id="specialSearch" placeholder="Type to filter..." />

  <!-- Subtabs -->
  <div class="tabs" id="special-subtabs">
    <!-- JS will auto-populate 25 buttons here -->
  </div>

  <!-- CSV Table Output -->
  <div id="special-table-container" class="csv-table-output" style="margin-top: 10px;"></div>
</div>


  <!-- Career Tab Script (unique to this page) -->
  <script>
    // Enhanced main tab switching (hides everything else)
  document.querySelectorAll(".main-tab").forEach(btn => {
    btn.addEventListener("click", () => {
      // Deactivate all main tabs
      document.querySelectorAll(".main-tab").forEach(b => b.classList.remove("active"));

      // Hide all tab content blocks
      document.querySelectorAll(".tab-content").forEach(t => {
        t.classList.remove("active");
        t.style.display = "none";
      });

      // Activate the clicked tab
      btn.classList.add("active");

      const targetTab = document.getElementById(btn.dataset.tab);
      targetTab.classList.add("active");
      targetTab.style.display = "block";
    });
  });


    // Career CSV data loading
    const csvUrls = {
      batting: "https://raw.githubusercontent.com/RoumyaDas/SPL/main/SPL/data/career/batting.csv",
      bowling: "https://raw.githubusercontent.com/RoumyaDas/SPL/main/SPL/data/career/bowling.csv",
      fielding: "https://raw.githubusercontent.com/RoumyaDas/SPL/main/SPL/data/career/fielding.csv"
    };

    const csvData = {};

    function parseCSV(csvText) {
      const lines = csvText.trim().split("\n");
      const headers = lines[0].split(",");
      const rows = lines.slice(1).map(line => {
        const values = line.split(",");
        return Object.fromEntries(headers.map((h, i) => [h, values[i]]));
      });
      return { headers, rows };
    }

    function renderCareerSection(type, data, searchTerm = "", sortConfig = {}) {
      const head = document.getElementById(`${type}Head`);
      const body = document.getElementById(`${type}Body`);
      head.innerHTML = "";
      body.innerHTML = "";

      const tr = document.createElement("tr");
      data.headers.forEach((h, idx) => {
        const th = document.createElement("th");
        th.textContent = h;
        th.style.cursor = "pointer";

        if (sortConfig.column === idx) {
          th.textContent += sortConfig.order === "asc" ? " ▲" : " ▼";
        }

        th.addEventListener("click", () => {
          const currentOrder = (sortConfig.column === idx && sortConfig.order === "asc") ? "desc" : "asc";
          const sortedRows = [...data.rows].sort((a, b) => {
            const aVal = a[h];
            const bVal = b[h];
            const isNumeric = !isNaN(parseFloat(aVal)) && !isNaN(parseFloat(bVal));

            if (isNumeric) {
              return currentOrder === "asc" ? aVal - bVal : bVal - aVal;
            } else {
              return currentOrder === "asc"
                ? aVal.localeCompare(bVal)
                : bVal.localeCompare(aVal);
            }
          });

          renderCareerSection(type, { headers: data.headers, rows: sortedRows }, 
            document.getElementById("careerSearch").value, {
              column: idx,
              order: currentOrder
            });
        });

        tr.appendChild(th);
      });
      head.appendChild(tr);

      let filtered = data.rows;
      if (searchTerm) {
        filtered = filtered.filter(row =>
          row[data.headers[0]].toLowerCase().includes(searchTerm.toLowerCase())
        );
      }

      filtered.slice(0, 20).forEach(row => {
        const tr = document.createElement("tr");
        data.headers.forEach(h => {
          const td = document.createElement("td");
          td.textContent = row[h];
          tr.appendChild(td);
        });
        body.appendChild(tr);
      });
    }

    // Load CSV data
    for (let type in csvUrls) {
      fetch(csvUrls[type])
        .then(res => res.text())
        .then(text => {
          const parsed = parseCSV(text);
          csvData[type] = parsed;
          if (type === "batting") {
            renderCareerSection("batting", parsed);
          }
        });
    }

    // Career subtab switching
    document.querySelectorAll(".career-subtab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".career-subtab").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".career-table").forEach(t => t.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
        renderCareerSection(btn.dataset.tab, csvData[btn.dataset.tab], 
          document.getElementById("careerSearch").value);
      });
    });

    // Career search
    document.getElementById("careerSearch").addEventListener("input", () => {
      const tab = document.querySelector(".career-subtab.active").dataset.tab;
      renderCareerSection(tab, csvData[tab], document.getElementById("careerSearch").value);
    });
  </script>


<script>
  fetch("https://raw.githubusercontent.com/RoumyaDas/SPL/main/README.md")
    .then(response => response.text())
    .then(text => {
      document.getElementById('readme-content').textContent = text;
    });
  </script>

<!-- Schedule tab stuff-->
<div id="schedule" class="tab-content">
  <h2>Match Schedule</h2>

  <div class="tabs" id="schedule-subtabs">
    <button class="schedule-subtab active" data-tab="sch-s01">S01</button>
    <button class="schedule-subtab" data-tab="sch-s02">S02</button>
    <button class="schedule-subtab" data-tab="sch-s03">S03</button>
  </div>

  <div id="sch-s01" class="schedule-table-container active"></div>
  <div id="sch-s02" class="schedule-table-container"></div>
  <div id="sch-s03" class="schedule-table-container"></div>
</div>

</body>
</html>